<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Multi-Tenant Azure App</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 800px; margin: auto; }
        .user-info, .stats-section { border: 1px solid #ccc; padding: 1em; margin-top: 1em; border-radius: 8px; }
        .button { background-color: #0078d4; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; }
        .button-secondary { background-color: #555; }
        input[type="text"] { padding: 8px; width: 300px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome to the Azure Resource Scanner</h1>

        {% if user %}
            <div class="user-info">
                <p>Hello, {{ user.get('name', user.get('preferred_username')) }}!</p>
                <p>Your email: {{ user.get('email', 'Not available') }}</p>
                <p>You are logged in from tenant: {{ user.get('tid') }}</p>
                <a href="{{ url_for('logout') }}" class="button button-secondary">Logout</a>
            </div>

            <div class="stats-section">
                <h2>Scan Your Azure Resources</h2>
                <p>
                    For this to work, an administrator from your organization must grant permissions,
                    and then assign the "Reader" role to this application on your Azure subscription.
                </p>
                
                <!-- Admin Consent Link -->
                <p>
                    <a href="https://login.microsoftonline.com/{{ user.get('tid') }}/adminconsent?client_id={{ client_id }}" target="_blank" class="button">
                        Grant Admin Permissions
                    </a>
                    <small>(Opens in a new tab)</small>
                </p>

                <hr>
                
                <!-- Form to get subscription ID -->
                <form action="{{ url_for('show_stats') }}" method="post">
                    <label for="subscription_id">Enter your Azure Subscription ID:</label><br>
                    <input type="text" id="subscription_id" name="subscription_id" required>
                    <button type="submit" class="button">Get Resource Groups</button>
                </form>
            </div>
        {% else %}
            <a href="{{ url_for('login') }}" class="button">Login with Microsoft</a>
        {% endif %}
    </div>
</body>
</html>

<!-- templates/stats.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Azure Resource Stats</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 800px; margin: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 1em; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Resource Groups in Subscription: {{ subscription_id }}</h1>
        {% if resource_groups %}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Location</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rg in resource_groups %}
                        <tr>
                            <td>{{ rg.name }}</td>
                            <td>{{ rg.location }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No resource groups found, or the application does not have Reader access to this subscription.</p>
        {% endif %}
        <br>
        <a href="{{ url_for('index') }}">Back to Home</a>
    </div>
</body>
</html>

<!-- templates/stats_error.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Error Getting Stats</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 800px; margin: auto; }
        .error-box { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 1em; border-radius: 8px; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Could Not Retrieve Azure Resources</h1>
        <div class="error-box">
            <p>
                An error occurred. This usually means that either an administrator has not yet granted the required permissions,
                or the "Reader" role has not been assigned to the application on the target subscription.
            </p>
            <p><strong>Error Details:</strong></p>
            <pre>{{ error_info | tojson(indent=4) }}</pre>
        </div>
        <br>
        <a href="{{ url_for('index') }}">Back to Home</a>
    </div>
</body>
</html>
